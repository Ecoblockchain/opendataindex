{% from 'macros.html' import popover_comparison_title,
popover_comparison_content %}

<div class="row">
    <div class="col-md-6">
        {% include 'dataviews/table_tools.html' %}
    </div>
    <div class="col-md-6">
        {% include 'dataviews/table_key.html' %}
    </div>
</div>
<section class="data-display">
    <div class="row">
        <div class="col-md-12">
            <table id="comparative-table" class="table table-striped data-table">
                <thead>
                    <tr>
                        <th class="data-table-column-heading">
                            <div>{{ gettext('Rank') }}</div>
                        </th>
                        <th class="data-table-column-heading">
                            <div>{{ gettext('Place') }}</div>
                        </th>
                        {% for dataset in scope.datasets %}
                        <th class="data-table-column-heading">
                            <div><a href="{{ SITEURL }}/datasets/{{ dataset.id }}/" title="{{ dataset.title }}">{{ dataset.title }}</a></div>
                        </th>
                        {% endfor %}
                        <th class="data-table-column-heading">
                            <div>{{ gettext('Score') }}</div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                {% for place in scope.places %}
                    <tr data-rank="{{ place[scope.rank_lookup] or ODI.na }}" data-score="{{ place[scope.score_lookup] or ODI.na }}" data-place="{{ place.slug }}">
                        <td class="rank" data-rank="{{ place[scope.rank_lookup] }}">
                            {{ place[scope.rank_lookup] }}
                        </td>
                        <td>
                            <a href="{{ SITEURL }}/places/{{ place.id }}/" title="{{ place.name }}">
                                {{ place.name }}
                            </a>
                        </td>
                        {% for dataset in scope.datasets %}
                        <td>
                            {% set entry = scope.entries|where('place', place.id)|where('dataset', dataset.id)|where('year', page.year)|first %}
                            <ul class="availability availability-comparative" data-toggle="popover" title="{{ popover_comparison_title(dataset, place)|e|safe }}" data-content="{{ popover_comparison_content(entry, place, dataset, scope.questions)|e|safe }}">
                            {% for question in scope.questions if question.score %}
                                {% if entry %}
                                    {% set state = entry[question.id] %}
                                {% else %}
                                    {% set state = '' %}
                                {% endif %}
                                <li class="{% if state == 'Y' %}yes{% elif state == 'N' %}no{% elif state == '?' %}maybe{% else %}{{ state }}{% endif %}" data-content="{% if state %}{{ state }}{% else %}{{ gettext('No data') }}{% endif %}">&nbsp;</li>
                            {% endfor %}
                            </ul>
                        </td>
                        {% endfor %}
                        <td class="score" data-score="{{ place[scope.score_lookup] or ODI.na }}">
                            {{ place[scope.score_lookup] or ODI.na }}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>
<div class="row">
    <div class="col-md-8">
        &nbsp;
    </div>
    <div class="col-md-4">
        {% include 'dataviews/table_key.html' %}
    </div>
</div>
